esSizeAdvisorJsonp([3],{11:function(e,s,i){"use strict";function t(e){return e&&e.__esModule?e:{default:e}}function r(e){if(!1!==e.shop.cookies_enabled){(0,p.debug)("[EasySize debug]: Attempting saveEasySizeUserId",e.easysize.user_id),z.default.set("esui",e.easysize.user_id,{expires:new Date(2147483647e3),path:"/"});var s=document.createElement("iframe");s.id="easysize_id",s.src=e.easysize.widget_url+"id?url="+encodeURIComponent(window.location.origin)+"&esid="+e.easysize.user_id,s.style.border=0,s.style.width="0",s.style.height="0",s.className="hidden",document.body.appendChild(s),_.default.on(window,"message",function(i){try{if(0===e.easysize.widget_url.indexOf(i.origin)){(0,p.debug)("[EasySize debug]: saveEasySizeUserId",e.easysize.user_id,i);try{document.body.removeChild(s)}catch(e){}}}catch(e){}})}}function d(e){var s=document.createElement("iframe");s.id="easysize_id",s.src=e.easysize.widget_url+"id?url="+encodeURIComponent(window.location.origin),s.style.border=0,s.style.width="0",s.style.height="0",s.className="hidden",document.body.appendChild(s),_.default.on(window,"message",function(i){try{if(0===e.easysize.widget_url.indexOf(i.origin)){var t=JSON.parse(i.data);try{document.body.removeChild(s)}catch(e){}if((0,p.debug)("[EasySize debug]: getEasySizeUserId data.esid",t.esid,i),t.hasOwnProperty("easysize_id_retrieved")){var d=z.default.get("esui");"-1"!==t.esid?((0,p.debug)("[EasySize debug]: getEasySizeUserId setting from data.esid",t.esid),e.easysize.user_id=t.esid):d&&"-1"!==d?((0,p.debug)("[EasySize debug]: getEasySizeUserId setting from localesid",d),e.easysize.user_id=d,r(e)):((0,p.debug)("[EasySize debug]: getEasySizeUserId setting from uuid",e.easysize.uuid),e.easysize.user_id=e.easysize.uuid,r(e)),(0,p.debug)("easysize_user_id_received",t),m.emitter.emit("easysize_user_id_received")}}}catch(e){(0,p.debug)("[EasySize debug]: ",e)}})}function a(e){var s=(0,p.parseQueryString)(window.location.href.split("?")[1]);if(s.hasOwnProperty("es_recommended_size")){e.track(32);var t=s.es_recommended_size,r=t;if(e.features.hasOwnProperty("append_size_with_recommended_fit")&&"enabled"===e.features.append_size_with_recommended_fit&&s.hasOwnProperty("es_recommended_fit")&&(r=s.es_recommended_size+"/"+s.es_recommended_fit,e.easysize.recommended_fit=s.es_recommended_fit),e.shop.update_size_dropdown(r,e))return e.track(7,r),e.track(17,e.product.stock[r]),e.easysize.user_type="r",e.easysize.calculated_size=s.es_recommended_size,e.easysize.original_calculated_size={size:s.es_recommended_size,predicted_fit:s.hasOwnProperty("es_recommended_fit")?s.es_recommended_fit:"",better_matches:[],accuracy:{percentage:100,title:"It's a perfect fit!",out_of_5:5,proven_by:50}},m.emitter.emit("easysize-size-selected"),m.emitter.emit("easysize_user_type_identified",e.easysize.user_type),!0}e.features.returning_user_mode?((0,p.subscribe)("easysize_current_user_size_calculated easysize_returning_user_size_calculated",function(){if(e.calculated_size.returning_user&&e.calculated_size.current_user){if(e.calculated_size.current_user.sizes.length>0){for(var s=!1,t=0;t<e.calculated_size.current_user.sizes.length;t++){var r=e.calculated_size.current_user.sizes[t],d=r.size;if(e.features.hasOwnProperty("append_size_with_recommended_fit")&&"enabled"===e.features.append_size_with_recommended_fit&&r.hasOwnProperty("recommended_fit")&&(d=r.size+"/"+r.recommended_fit,e.easysize.recommended_fit=r.recommended_fit),e.easysize.user_type="c",e.easysize.calculated_size_proven_by=r.accuracy.proven_by,e.easysize.calculated_size=r.size,e.easysize.original_calculated_size=r,r.secondary_size&&(e.easysize.calculated_size=r.size+" / "+r.secondary_size,d=r.size+" / "+r.secondary_size),0!==Object.keys(e.product.fits_in_stock).length){e.track(7,e.easysize.calculated_size),s=!0,e.track(17,e.product.fits_in_stock[r.size]),0===e.product.fits_in_stock[r.size]?i.e(9).then(function(s){(0,i(17)("./"+e.easysize.product).addSizeRecommendedText)("es-recommended","returning_user_text_out_of_stock","es-recommended-size",e),e.track(21)}.bind(null,i)).catch(i.oe):e.shop.update_size_dropdown(d,e)&&m.emitter.emit("easysize-size-selected");break}if(e.product.stock.hasOwnProperty(r.size)){e.track(7,e.easysize.calculated_size),s=!0,e.track(17,e.product.stock[r.size]),0===e.product.stock[r.size]?i.e(9).then(function(s){(0,i(17)("./"+e.easysize.product).addSizeRecommendedText)("es-recommended","returning_user_text_out_of_stock","es-recommended-size",e),e.track(21)}.bind(null,i)).catch(i.oe):e.shop.update_size_dropdown(d,e)&&m.emitter.emit("easysize-size-selected");break}e.features.hasOwnProperty("ignore_stock_check")&&(e.track(7,e.easysize.calculated_size),s=!0,e.product.stock.hasOwnProperty(r.size)?e.track(17,e.product.stock[r.size]):e.track(21),e.shop.update_size_dropdown(d,e)&&m.emitter.emit("easysize-size-selected"))}s||e.track(22,e.calculated_size.current_user.sizes.map(function(e){return e.size}).join(","))}else if(e.calculated_size.returning_user.sizes.length>0){for(var a=!1,c=0;c<e.calculated_size.returning_user.sizes.length;c++){var o=e.calculated_size.returning_user.sizes[c],n=o.size;if(e.features.hasOwnProperty("append_size_with_recommended_fit")&&"enabled"===e.features.append_size_with_recommended_fit&&o.hasOwnProperty("recommended_fit")&&(n=o.size+"/"+o.recommended_fit,e.easysize.recommended_fit=o.recommended_fit),e.easysize.user_type="r",e.easysize.calculated_size_proven_by=o.accuracy.proven_by,e.easysize.calculated_size=o.size,e.easysize.original_calculated_size=o,o.secondary_size&&(e.easysize.calculated_size=o.size+" / "+o.secondary_size,n=o.size+" / "+o.secondary_size),(0,p.debug)("ES","pre logic"),0!==Object.keys(e.product.fits_in_stock).length){(0,p.debug)("ES fits_in_stock",7,o.size),e.track(7,e.easysize.calculated_size),a=!0,e.track(17,e.product.fits_in_stock[o.size]),0===e.product.fits_in_stock[o.size]?(i.e(9).then(function(s){(0,i(17)("./"+e.easysize.product).addSizeRecommendedText)("es-recommended","returning_user_text_out_of_stock","es-recommended-size",e),e.track(21)}.bind(null,i)).catch(i.oe),e.shop.update_size_dropdown(n,e)):e.shop.update_size_dropdown(n,e)&&m.emitter.emit("easysize-size-selected");break}if(e.product.stock.hasOwnProperty(o.size)){(0,p.debug)("ES stock",7,o.size),(0,p.debug)(e),(0,p.debug)(e.track),e.track(7,e.easysize.calculated_size),a=!0,e.track(17,e.product.stock[o.size]),0===e.product.stock[o.size]?(i.e(9).then(function(s){(0,i(17)("./"+e.easysize.product).addSizeRecommendedText)("es-recommended","returning_user_text_out_of_stock","es-recommended-size",e),(0,p.debug)(e),(0,p.debug)(e.track),e.track(7,e.easysize.calculated_size),e.track(21)}.bind(null,i)).catch(i.oe),e.shop.update_size_dropdown(n,e)):e.shop.update_size_dropdown(n,e)&&m.emitter.emit("easysize-size-selected");break}e.features.hasOwnProperty("ignore_stock_check")&&(e.track(7,e.easysize.calculated_size),a=!0,e.product.stock.hasOwnProperty(o.size)?e.track(17,e.product.stock[o.size]):e.track(21),e.shop.update_size_dropdown(n,e)&&m.emitter.emit("easysize-size-selected"))}a||e.track(22,e.calculated_size.returning_user.sizes.map(function(e){return e.size}).join(","))}-1!==e.easysize.response_headers.indexOf("mse: True")&&-1!==e.easysize.response_headers.indexOf("dse: True")?e.track(34,"dse-mse"):-1!==e.easysize.response_headers.indexOf("mse: True")?e.track(34,"mse"):-1!==e.easysize.response_headers.indexOf("dse: True")&&e.track(34,"dse"),m.emitter.emit("easysize_user_type_identified",e.easysize.user_type)}}),c(e,function(s){if(0!==Object.keys(e.product.fits_in_stock).length&&s.sizes.length>0){for(var i=0,t=0;t<s.sizes.length;t++)if(e.product.fits_in_stock.hasOwnProperty(s.sizes[t].recommended_fit)&&e.product.fits_in_stock[s.sizes[t].recommended_fit].hasOwnProperty(s.sizes[t].size)){i=t;break}(0,p.debug)("Based on fits in stock",s.sizes[i]),e.calculated_size.current_user={sizes:[s.sizes[i]]}}else if(e.product.available_fits&&e.product.available_fits.length>0&&s.sizes.length>0){var r=0;if(e.product.available_fits&&s.sizes.length>1)for(var d=0;d<s.sizes.length;d++)if(-1!==e.product.available_fits.indexOf(s.sizes[d].recommended_fit)){r=d;break}e.calculated_size.current_user={sizes:[s.sizes[r]]}}else e.calculated_size.current_user={sizes:s.sizes};m.emitter.emit("easysize_current_user_size_calculated")}),o(e,function(s){if(0!==Object.keys(e.product.fits_in_stock).length&&s.sizes.length>0){for(var i=0,t=0;t<s.sizes.length;t++)if(e.features.check_fit_stock){var r=s.sizes[t].size,d=!1;-1!==e.product.available_lengths.indexOf(s.sizes[t].recommended_length)&&(d=s.sizes[t].recommended_length),-1!==e.product.available_fits.indexOf(s.sizes[t].recommended_fit)&&(d=s.sizes[t].recommended_fit);e.features.check_fit_stock.replace("{s}",r).replace("{f}",d);if(d){s.sizes[t].size=e.features.check_fit_stock.replace("{s}",r).replace("{f}",d),s.sizes[t].recommended_length=null,s.sizes[t].recommended_fit=null,i=t;break}}else if(e.product.fits_in_stock.hasOwnProperty(s.sizes[t].recommended_fit)&&e.product.fits_in_stock[s.sizes[t].recommended_fit].hasOwnProperty(s.sizes[t].size)){i=t;break}console.log("Based on fits in stock",s.sizes[i]),e.calculated_size.returning_user={sizes:[s.sizes[i]]}}else if(e.product.available_fits&&e.product.available_fits.length>0&&s.sizes.length>0){var a=0;if(e.product.available_fits&&s.sizes.length>1)for(var c=0;c<s.sizes.length;c++)if(-1!==e.product.available_fits.indexOf(s.sizes[c].recommended_fit)){a=c;break}console.log("Based on available fits",s.sizes[a]),e.calculated_size.returning_user={sizes:[s.sizes[a]]}}else e.calculated_size.returning_user={sizes:s.sizes};m.emitter.emit("easysize_returning_user_size_calculated")})):((0,p.debug)("[EasySize debug]: Returning user mode disabled"),m.emitter.emit("easysize_user_type_identified",e.easysize.user_type))}function c(e,s){return void s({sizes:[]})}function o(e,s){var i={product_type:e.product.category_id,product_gender:e.product.gender,product_brand:e.product.brand_id,sizes_in_stock:JSON.stringify(e.product.stock),fit_variants:JSON.stringify(e.product.available_fits),length_variants:JSON.stringify(e.product.available_lengths),easysize_user:e.easysize.user_id};-1!==e.product.fit_id&&(i.product_fit=e.product.fit_id),e.product.model&&(i.product_model=e.product.model),e.product.sku&&(i.product_sku=e.product.sku);var t=(0,f.default)({url:""+e.easysize.api_url+e.shop.generated_shop_id+"/size/get_size_with_orders/",method:"GET",data:i,error:function(e){(0,p.debug)("[EasySize debug]: Error getting size for returning user")},success:function(i){i.status_code?(0,p.debug)("[EasySize debug]: EasySize size failed to calculate with ["+i.status_code+"] "+i.error):(e.easysize.response_headers=t.request.getAllResponseHeaders(),s(i))}})}Object.defineProperty(s,"__esModule",{value:!0}),s.saveEasySizeUserId=r,s.getEasySizeUserId=d,s.recognizeUserType=a;var n=i(9),_=t(n),u=i(6),z=t(u),l=i(12),f=t(l),p=i(3),m=i(2)}});
//# sourceMappingURL=../maps/3d1613b58e71c79fab8d.chunks/easysize.788a4fd7829e48376cb5.js.map